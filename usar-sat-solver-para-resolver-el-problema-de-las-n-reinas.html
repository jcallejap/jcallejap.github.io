
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">









 

<meta name="author" content="jcallejap" />
<meta name="description" content="Dentro de las múltiples formas de resolver el problema de las N-Reinas, usar un SAT-Solver es una de las menos usadas." />
<meta name="keywords" content="C++, Optimización">


  <meta property="og:site_name" content="Programando en tiempo real"/>
  <meta property="og:title" content="Usar SAT Solver para resolver el problema de las N reinas."/>
  <meta property="og:description" content="Dentro de las múltiples formas de resolver el problema de las N-Reinas, usar un SAT-Solver es una de las menos usadas."/>
  <meta property="og:locale" content="es_ES"/>
  <meta property="og:url" content="/usar-sat-solver-para-resolver-el-problema-de-las-n-reinas.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-11-25 00:00:00+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/jcallejap.html">
  <meta property="article:section" content="Resolución de problemas en C++"/>
  <meta property="article:tag" content="C++"/>
  <meta property="article:tag" content="Optimización"/>
  <meta property="og:image" content="/images/profile.png">

  <title>Programando en tiempo real &ndash; Usar SAT Solver para resolver el problema de las N reinas.</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="/">
      <img src="/images/profile.png" alt="" title="">
    </a>

    <h1>
      <a href="/"></a>
    </h1>

    <p>Programación (principalmente) en C++</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="/pages/sobre-mi.html#sobre-mi">
                Sobre mí
              </a>
            </li>

          <li>
            <a target="_self" href="https://getpelican.com/" >Pelican</a>
          </li>
          <li>
            <a target="_self" href="https://www.python.org/" >Python.org</a>
          </li>
          <li>
            <a target="_self" href="https://en.cppreference.com/w/" >C++</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-stack-overflow"
           href="https://stackoverflow.com/users/218774/j-calleja"
           target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/jcallejap"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="/">Home</a>

  <a href="/archives">Archives</a>
  <a href="/categories">Categories</a>
  <a href="/tags">Tags</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="usar-sat-solver-para-resolver-el-problema-de-las-n-reinas">Usar SAT Solver para resolver el problema de las N reinas.</h1>
    <p>
      Posted on Sat 25 November 2023 in <a href="/category/resolucion-de-problemas-en-c.html">Resolución de problemas en C++</a>

    </p>
  </header>


  <div>
    <h1>0. Qué es un SAT Solver</h1>
<p>Un <a href="https://en.wikipedia.org/wiki/SAT_solver">SAT Solver</a> es un programa de ordenador cuyo objetivo es resolver el 
<a href="https://en.wikipedia.org/wiki/SAT_solver">Problema de satisfacibilidad booleana</a>. </p>
<p>De forma informal, se podría definir como:</p>
<p>Dado un conjunto de variables booleanas <em>(true/false)</em> y un conjunto de ecuaciones booleanas sobre esas variables, 
comprobar si el sistema de ecuaciones tiene alguna solución.</p>
<p>Este conjunto de ecuaciones puede tener muchas formas, pero generalmente se usa la forma CNF 
(<a href="https://en.wikipedia.org/wiki/Conjunctive_normal_form">Conjuntive Normal Form</a>):</p>
<ul>
<li>Se compone de un conjunto de ecuaciones que deben evaluar a <em>true</em>.</li>
<li>Cada ecuación está compuesta por una sucesión de variables (que pueden estar negadas) enlazadas por la operación OR.</li>
</ul>
<p>Por ejemplo, si usamos la siguiente nomenclatura:</p>
<ul>
<li>Operación OR: +</li>
<li>Operación AND: *</li>
<li>Operación NOT: '</li>
<li>True: 1</li>
<li>False: 0</li>
</ul>
<p>Las siguientes ecuaciones estarían en forma CNF:</p>
<ul>
<li>a + b + c = 1</li>
<li>a + b' + c = 1</li>
</ul>
<p>Mientras que las siguientes ecuaciones no están en forma CNF:</p>
<ul>
<li>(a' * b' * c')' = 1</li>
<li>(a + b)' = 1</li>
</ul>
<h1>1. SAT Solver en C++</h1>
<p>Existen <a href="https://stackoverflow.com/q/41057441/218774">múltiples librerías</a> para resolver el problema SAT en C++.</p>
<p>La librería más conocida probablemente sea <a href="https://github.com/niklasso/minisat">MiniSAT</a>.
Aunque ya no se mantiene, el código es funcional.</p>
<p>Otra opción es <a href="https://www.labri.fr/perso/lsimon/research/glucose/">GLUCOSE</a>. 
Tiene una interfaz similar a MiniSAT, pero sigue siendo mantenida y está más optimizada para ciertos casos.</p>
<p>En este ejemplo, vamos a usar MiniSAT porque está integrada dentro de VCPKG.</p>
<h1>2. Uso de la librería MinSAT</h1>
<p>Como ejemplo, veamos cómo resolver las ecuaciones</p>
<div class="highlight"><pre><span></span><code> v0 + v1&#39; = 1
 v0&#39; = 1
</code></pre></div>

<p>El primer paso es crear un objeto del tipo <code>Minisat::Solver</code>. </p>
<div class="highlight"><pre><span></span><code><span class="nt">Minisat</span><span class="p">::</span><span class="nd">Solver</span><span class="w"> </span><span class="nt">solver</span><span class="o">;</span>
</code></pre></div>

<p>Este es el objeto principal de la librería y se encarga de gestionar las variables, las ecuaciones y de la resolución del problema.</p>
<p>El segundo paso es crear las variables. 
Para esto, se utiliza la función <code>AddVar</code> del objeto <code>Minisat::Solver</code> que acabamos de crear.
Internalmente, las variables son únicamente un índice, de cero al número de variables.
Por lo tanto, aunque esta función devuelve un objeto de tipo <code>Var</code>, no es estrictamente obligatorio almacenarlo porque es sencillo referenciar una variable usando su índice con el método <code>mkLit</code>.</p>
<p>En nuestro caso, vamos a crear dos variables:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">newVar</span><span class="p">();</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">newVar</span><span class="p">();</span>
</code></pre></div>

<p>El tercer paso es crear las ecuaciones. 
Como deben estar en formato CNF, una ecuación es únicamente un vector de variables, algunas de las cuales podrían estar negadas.
Por ello, podemos usar el vector <code>Minisat::vec&lt;Minisat::Lit&gt;</code> para almacenar una ecuación.
Antes de introducir una variable en el vector, podemos modificarla con el operador <code>~</code> para indicar que está negada.</p>
<p>Para añadir la ecuación a nuestro objeto, usamos el método <code>addClause</code>, al que podemos pasar uno, dos, tres literales o un vector.</p>
<p>En el ejemplo, queremos crear dos ecuaciones, por lo que podemos hacer:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//  v0 + v1&#39; = 1</span>
<span class="n">solver</span><span class="p">.</span><span class="n">addClause</span><span class="p">(</span><span class="n">Minisat</span><span class="o">::</span><span class="n">mkLit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="o">~</span><span class="n">Minisat</span><span class="o">::</span><span class="n">mkLit</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="c1">//  v0&#39; = 1</span>
<span class="n">solver</span><span class="p">.</span><span class="n">addClause</span><span class="p">(</span><span class="o">~</span><span class="n">Minisat</span><span class="o">::</span><span class="n">mkLit</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div>

<p>El paso final es llamar a la función <code>solve</code> para calcular la solución. 
Esta función devuelve un <code>bool</code> indicando si se ha podido encontrar una solución.
En caso positivo, se puede preguntar el valor de la solución encontrada para una variable usando el método <code>modelValue</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">solver</span><span class="p">.</span><span class="nc">solve</span><span class="o">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="nf">modelValue</span><span class="p">(</span><span class="n">Minisat</span><span class="err">::</span><span class="nf">mkLit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">l_True</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="nf">modelValue</span><span class="p">(</span><span class="n">Minisat</span><span class="err">::</span><span class="nf">mkLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">l_True</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h1>3. Planteamiento general del problema de las N reinas</h1>
<p>El problema de las N reinas es una generalización del problema de las <a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle">8 reinas</a>.
El objetivo es colocar N reinas de ajedrez dentro de un tablero de tamaño NxN de manera que ninguna de ellas pueda atacarse.</p>
<p>Como recordatorio, las reinas en ajedrez pueden moverse cualquier cantidad de casillas en horizontal, vertical y diagonal.</p>
<p>Se sabe que este problema tiene múltiples soluciones para N &gt; 3.</p>
<h1>4. Planteamiento del problema de las N reinas para un SAT Solver</h1>
<h2>Variables</h2>
<p>Como en cualquier problema de este tipo, el primer paso es decidir qué variables vamos a usar.
Puesto que vamos a usar variables booleanas (true o false), sería complicado usarlas para almacenar la posición de cada reina, ya que es un número natural.</p>
<p>Por lo tanto, lo más sencillo es usar las variables para representar cada una de las casillas del tablero, 
donde el valor de la variable significaría:</p>
<ul>
<li>True: hay una reina en esta casilla.</li>
<li>False: la casilla está vacía.</li>
</ul>
<p>De esta manera, necesitaremos NxN variables booleanas para definir un tablero. </p>
<p>La numeración de las casillas se hará partiendo de la esquina superior izquierda y de forma vertical. 
Es decir, para un tablero 4x4:</p>
<div class="highlight"><pre><span></span><code><span class="mf">1</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="n">D</span>
<span class="mf">2</span><span class="w"> </span><span class="mf">6</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">E</span>
<span class="mf">3</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">F</span>
<span class="mf">4</span><span class="w"> </span><span class="mf">8</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">G</span>
</code></pre></div>

<h2>Ecuaciones</h2>
<p>Todas las ecuaciones son del tipo: "en este conjunto de casillas debe haber una y sólo una reina",
por lo que primero vamos a ver cómo se plantea ese tipo de ecuacaiones.</p>
<h3>Tiene que haber al menos una variable a <em>true</em></h3>
<p>Basta con indicar que alguna de las variables tiene que ser cierta.</p>
<p>Por ejemplo, para la primera columna de un tablero 4x4:</p>
<div class="highlight"><pre><span></span><code>a1 + a2 + a3 + a4 = 1
</code></pre></div>

<h3>No puede haber dos variables a <em>true</em></h3>
<p>Esto se consigue añadiendo una ecuación para <strong>cada las pareja de variables</strong> del grupo, del tipo:</p>
<div class="highlight"><pre><span></span><code>ai&#39; + aj&#39; = 1
</code></pre></div>

<p>Por ejemplo, en el caso de la primera columna del tablero 4x4, tendríamos las siguientes ecuaciones:</p>
<div class="highlight"><pre><span></span><code>a1&#39; + a2&#39; = 1
a1&#39; + a3&#39; = 1
a1&#39; + a4&#39; = 1
a2&#39; + a3&#39; = 1
a2&#39; + a4&#39; = 1
a3&#39; + a4&#39; = 1
</code></pre></div>

<h3>Hay una y sólo una variable a <em>true</em></h3>
<p>Se consigue usando usando las ecuaciones anteriores. 
El primer grupo indica que hay al menos una y el segundo que no hay más de una.
Por lo tanto, si unimos ambos grupos de ecuaciones conseguiremos que aparezca una y sólo una variable activa en cada grupo.</p>
<p>Por ejemplo, para la primera columna del tablero 4x4, deberíamos añadir:</p>
<div class="highlight"><pre><span></span><code>a1 + a2 + a3 + a4 = 1
a1&#39; + a2&#39; = 1
a1&#39; + a3&#39; = 1
a1&#39; + a4&#39; = 1
a2&#39; + a3&#39; = 1
a2&#39; + a4&#39; = 1
a3&#39; + a4&#39; = 1
</code></pre></div>

<h3>Aplicar las ecuaciones al tablero</h3>
<p>Utilizando las ecuaciones de los apartados anteriores, formamos grupos de casillas donde sólo puede haber una reina:</p>
<ul>
<li>Filas: en cada fila del tablero sólo puede haber un <em>true</em>. </li>
<li>Columna: en cada columna del tablero sólo puede haber un <em>true</em>. </li>
<li>Diagonales: en cada diagonal del tablero sólo puede haber un <em>true</em>.</li>
</ul>
<p>Después, para cada conjunto, añadimos las ecuaciones descritas anteriormente.</p>
<h3>Crecimiento del número de ecuaciones</h3>
<p>Una forma de ver la complijidad del problema es calcular el número de ecuaciones que se necesitan.</p>
<p>Para una tablero de tamaño N, tendremos los siguientes grupos:</p>
<ul>
<li>Filas: N grupos.</li>
<li>Columnas: N grupos.</li>
<li>Diagonales: 2(2N-3) grupos.</li>
</ul>
<p>Total de grupos: N + N + 2(2N-3) = 6N - 6</p>
<p>Cada grupo tiene <em>(1 + N(N - 1))</em> ecuaciones.
Por lo tanto, el número final de ecuaciones sería: (6N - 6)(1 + N(N - 1)) = 6N^3 - 12N^2 + 6N</p>
<p>Es decir, el número de ecuaciones crece de manera cúbica con el tamaño del tablero 
por lo que podemos esperar que el tiempo de resolución crezca de manera similar.</p>
<h2>Implementación de las ecuaciones en MiniSAT</h2>
<p>Para plantear el problema en MiniSAT basta con saber cómo se implementan los dos tipos de ecuaciones descritos anteriormente y 
luego generar los grupos necesarios para el tablero.</p>
<p>Si tenemos las variables de un grupo dentro de un <code>Minisat::vec&lt;Minisat::Lit&gt;</code> llamado <code>literals</code>, las ecuaciones quedarían:</p>
<ul>
<li>Tiene que haber al menos una variable a <em>true</em>: </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">solver</span><span class="p">.</span><span class="n">addClause</span><span class="p">(</span><span class="n">literals</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>No puede haber dos variables a <em>true</em>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">literals</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">literals</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">solver</span><span class="p">.</span><span class="n">addClause</span><span class="p">(</span><span class="o">~</span><span class="n">literals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="o">~</span><span class="n">literals</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h1>Conclusión</h1>
<p>Se ha implementado la solución propuesta en <a href="https://github.com/jcallejap/QueenSat">github</a>.
Se ha comprobado que es capaz de resolver tableros y dar una solución correcta.</p>
<p>Los tiempos empleados en un i7-9750H son:</p>
<ul>
<li>100x100 :    138 ms</li>
<li>200x200 :   1049 ms</li>
<li>400x400 :   8032 ms</li>
</ul>
<p>Por lo que se observa que, efectivamente, el algoritmo es cúbico con el tamaño del tablero ya que si doblamos el tamaño se multiplica por ocho el tiempo de resolución.
A partir de un tablero de 400x400 la memoria utilizada por el programa supera a la del equipo, por lo que el tiempo se dispara.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/c.html">C++</a>
      <a href="/tag/optimizacion.html">Optimización</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2024  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="/theme/img/cc/by-sa.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Programando en tiempo real ",
  "url" : "",
  "image": "/images/profile.png",
  "description": "Ejemplos de algoritmos, curiosidades, y cosas que voy descubriendo mientras desarrollo aplicaciones."
}
</script>
</body>
</html>